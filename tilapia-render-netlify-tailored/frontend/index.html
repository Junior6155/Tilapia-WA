<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tilapia Distribution Management System</title>
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#1565c0">
  <script defer src="script.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --primary: #1565c0;
      --primary-dark: #0d47a1;
      --secondary: #4fc3f7;
      --success: #4caf50;
      --warning: #ff9800;
      --error: #f44336;
      --info: #2196f3;
      --light: #f5f5f5;
      --dark: #333;
      --border: #ddd;
      --shadow: rgba(0, 0, 0, 0.1);
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%); color: var(--dark); line-height: 1.6; }
    .header { background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%); color: white; padding: 1rem 2rem; box-shadow: 0 2px 10px var(--shadow); position: sticky; top: 0; z-index: 100; }
    .header h1 { font-size: 1.6rem; display:flex; align-items:center; gap:.5rem; }
    .container { max-width: 1200px; margin: 0 auto; padding: 1rem; }
    .card { background:white; border-radius: 12px; box-shadow: 0 4px 15px var(--shadow); margin: 1rem 0; overflow:hidden; }
    .card-header { background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%); color:white; padding: 1rem; font-weight:600;}
    .card-body { padding:1rem; }
    .btn { background: var(--primary); color:white; border:none; padding:.6rem 1rem; border-radius:8px; cursor:pointer; }
    .btn:hover { background: var(--primary-dark); }
    .grid { display:grid; gap:1rem; grid-template-columns: repeat(auto-fit,minmax(240px,1fr)); }
    .hidden { display:none !important; }
    input, select { width:100%; padding:.6rem .8rem; border:2px solid var(--border); border-radius:8px; }
    table { width:100%; border-collapse:collapse; }
    th, td { padding:.75rem; border-bottom:1px solid var(--border); text-align:left; }
    th { background:var(--light); text-transform:uppercase; font-size:.8rem; }
    nav { display:flex; gap:.25rem; overflow:auto; background:white; border-bottom:2px solid var(--border); }
    nav button { background:none; border:none; padding:.75rem 1rem; cursor:pointer; }
    nav .active { border-bottom:3px solid var(--primary); color:var(--primary); background:var(--light); }
    .alert { position: fixed; top: 12px; right: 12px; padding: .75rem 1rem; border-radius: 8px; color:white; box-shadow:0 2px 12px rgba(0,0,0,.2); }
    .ok { background:#4caf50; } .warn { background:#ff9800; } .err { background:#f44336; }
    .login { max-width: 420px; margin: 10vh auto; }
    canvas { background:white; border-radius: 8px; padding: 6px; }
  </style>
</head>
<body>
  <header class="header">
    <h1>ğŸŸ Tilapia Distribution Management System</h1>
    <div id="userBadge"></div>
  </header>

  <div class="login card" id="loginCard">
    <div class="card-header">Login</div>
    <div class="card-body">
      <div class="grid">
        <div>
          <label>Email</label>
          <input id="loginEmail" type="email" placeholder="admin@heroent.local" />
        </div>
        <div>
          <label>Password</label>
          <input id="loginPassword" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" />
        </div>
      </div>
      <div style="margin-top: .75rem;">
        <button class="btn" onclick="login()">Sign in</button>
        <small style="display:block;margin-top:.5rem;">Default admin is set via backend .env</small>
      </div>
    </div>
  </div>

  <main class="container hidden" id="app">
    <nav>
      <button class="active" onclick="showTab('dashboard', event)">ğŸ“Š Dashboard</button>
      <button onclick="showTab('customers', event)">ğŸ‘¥ Customers</button>
      <button onclick="showTab('sales', event)">ğŸ’° Sales</button>
      <button onclick="showTab('payments', event)">ğŸ’³ Payments</button>
      <button onclick="showTab('inventory', event)">ğŸ“¦ Inventory</button>
      <button onclick="showTab('expenses', event)">ğŸ’¸ Expenses</button>
      <button onclick="showTab('reports', event)">ğŸ“ˆ Reports</button>
      <button onclick="showTab('settings', event)">âš™ï¸ Settings</button>
    </nav>

    <section id="dashboard" class="card">
      <div class="card-header">Overview</div>
      <div class="card-body">
        <div class="grid">
          <div class="card"><div class="card-body"><strong>Today's Sales</strong><div id="todaySales">â‚µ0.00</div></div></div>
          <div class="card"><div class="card-body"><strong>Today's Payments</strong><div id="todayPayments">â‚µ0.00</div></div></div>
          <div class="card"><div class="card-body"><strong>Pending Debt</strong><div id="pendingDebt">â‚µ0.00</div></div></div>
          <div class="card"><div class="card-body"><strong>Low Stock Items</strong><div id="lowStockItems">0</div></div></div>
        </div>
        <div class="card" style="margin-top:1rem;">
          <div class="card-header">Sales vs Expenses (Last 30 days)</div>
          <div class="card-body">
            <canvas id="chartSalesExpenses" height="120"></canvas>
          </div>
        </div>
      </div>
    </section>

    <section id="customers" class="card hidden">
      <div class="card-header">Customers</div>
      <div class="card-body">
        <div class="grid">
          <div><label>Name</label><input id="c_name"></div>
          <div><label>Phone</label><input id="c_phone"></div>
          <div><label>Location</label><input id="c_location"></div>
          <div><label>Email</label><input id="c_email"></div>
          <div><label>Type</label><select id="c_type"><option>regular</option><option>wholesale</option><option>retail</option></select></div>
          <div><label>Credit Limit</label><input id="c_limit" type="number" value="1000"></div>
        </div>
        <div style="margin-top:.75rem;"><button class="btn" onclick="addCustomer()">â• Add Customer</button></div>
        <table style="margin-top:1rem;"><thead><tr><th>Name</th><th>Phone</th><th>Debt</th><th>Actions</th></tr></thead><tbody id="customersTable"></tbody></table>
      </div>
    </section>

    <section id="sales" class="card hidden">
      <div class="card-header">Record Sale</div>
      <div class="card-body">
        <div class="grid">
          <div><label>Date</label><input id="s_date" type="date"></div>
          <div><label>Customer</label><select id="s_customer"></select></div>
          <div><label>Fish Size</label><select id="s_size"><option>TSS</option><option>SB</option><option>Eco</option><option>Reg</option><option>S1</option><option>S2</option><option>S3</option></select></div>
          <div><label>Quantity (kg)</label><input id="s_qty" type="number" step="0.1"></div>
          <div><label>Unit Price (â‚µ/kg)</label><input id="s_unit" type="number" step="0.01"></div>
          <div><label>Total Amount</label><input id="s_total" type="number" step="0.01"></div>
          <div><label>Type</label><select id="s_type"><option>cash</option><option>credit</option></select></div>
          <div><label>Notes</label><input id="s_notes"></div>
        </div>
        <div style="margin-top:.75rem;"><button class="btn" onclick="recordSale()">ğŸ’° Record Sale</button></div>
        <table style="margin-top:1rem;"><thead><tr><th>Date</th><th>Customer</th><th>Size</th><th>Qty</th><th>Amount</th><th>Type</th></tr></thead><tbody id="salesTable"></tbody></table>
      </div>
    </section>

    <section id="payments" class="card hidden">
      <div class="card-header">Record Payment</div>
      <div class="card-body">
        <div class="grid">
          <div><label>Date</label><input id="p_date" type="date"></div>
          <div><label>Customer</label><select id="p_customer"></select></div>
          <div><label>Amount</label><input id="p_amount" type="number" step="0.01"></div>
          <div><label>Method</label><select id="p_method"><option>cash</option><option>mobile_money</option><option>bank_transfer</option><option>cheque</option></select></div>
          <div><label>Reference</label><input id="p_ref"></div>
        </div>
        <div style="margin-top:.75rem;"><button class="btn" onclick="recordPayment()">ğŸ’³ Record Payment</button></div>
        <table style="margin-top:1rem;"><thead><tr><th>Date</th><th>Customer</th><th>Amount</th><th>Method</th></tr></thead><tbody id="paymentsTable"></tbody></table>
      </div>
    </section>

    <section id="inventory" class="card hidden">
      <div class="card-header">Inventory</div>
      <div class="card-body">
        <div class="grid">
          <div><label>Date</label><input id="i_date" type="date"></div>
          <div><label>Fish Size</label><select id="i_size"><option>TSS</option><option>SB</option><option>Eco</option><option>Reg</option><option>S1</option><option>S2</option><option>S3</option></select></div>
          <div><label>Quantity (kg)</label><input id="i_qty" type="number" step="0.1"></div>
          <div><label>Cost Price (â‚µ/kg)</label><input id="i_cost" type="number" step="0.01"></div>
          <div><label>Supplier</label><input id="i_supplier"></div>
        </div>
        <div style="margin-top:.75rem;"><button class="btn" onclick="addStock()">ğŸ“¦ Add Stock</button></div>
        <table style="margin-top:1rem;"><thead><tr><th>Fish Size</th><th>Stock (kg)</th><th>Cost (â‚µ/kg)</th><th>Updated</th></tr></thead><tbody id="inventoryTable"></tbody></table>
      </div>
    </section>

    <section id="expenses" class="card hidden">
      <div class="card-header">Expenses</div>
      <div class="card-body">
        <div class="grid">
          <div><label>Date</label><input id="e_date" type="date"></div>
          <div><label>Category</label><select id="e_cat"><option>transport</option><option>fuel</option><option>maintenance</option><option>supplies</option><option>utilities</option><option>staff</option><option>rent</option><option>insurance</option><option>marketing</option><option>other</option></select></div>
          <div><label>Amount</label><input id="e_amount" type="number" step="0.01"></div>
          <div><label>Method</label><select id="e_method"><option>cash</option><option>mobile_money</option><option>bank_transfer</option><option>cheque</option></select></div>
          <div><label>Description</label><input id="e_desc"></div>
        </div>
        <div style="margin-top:.75rem;"><button class="btn" onclick="addExpense()">ğŸ’¸ Record Expense</button></div>
        <table style="margin-top:1rem;"><thead><tr><th>Date</th><th>Category</th><th>Description</th><th>Amount</th></tr></thead><tbody id="expensesTable"></tbody></table>
      </div>
    </section>

    <section id="reports" class="card hidden">
      <div class="card-header">Reports</div>
      <div class="card-body">
        <div class="grid">
          <div><label>Start</label><input id="r_start" type="date"></div>
          <div><label>End</label><input id="r_end" type="date"></div>
        </div>
        <div style="margin-top:.75rem;"><button class="btn" onclick="loadSummary()">ğŸ“Š Generate Summary</button></div>
        <pre id="reportBox" style="background:#f8f8f8;padding:1rem;border-radius:8px;overflow:auto;"></pre>
      </div>
    </section>

    <section id="settings" class="card hidden">
      <div class="card-header">Settings & Prices</div>
      <div class="card-body">
        <div class="grid">
          <div><label>Business Name</label><input id="s_name"></div>
          <div><label>Phone</label><input id="s_phone"></div>
          <div><label>Email</label><input id="s_email"></div>
          <div><label>Default Credit Limit</label><input id="s_limit" type="number"></div>
          <div><label>Low Stock Alert (kg)</label><input id="s_low" type="number" step="0.1"></div>
          <div><label>Bulk Discount Threshold (kg)</label><input id="s_thresh" type="number" step="0.1"></div>
          <div><label>Bulk Discount Rate (%)</label><input id="s_rate" type="number" step="0.1"></div>
        </div>
        <div style="margin-top:.75rem;"><button class="btn" onclick="saveSettings()">Save Settings</button></div>
        <h3 style="margin-top:1rem;">Prices (â‚µ/kg)</h3>
        <table><thead><tr><th>Size</th><th>Price</th></tr></thead><tbody id="priceTable"></tbody></table>
        <div style="margin-top:.75rem;"><button class="btn" onclick="savePrices()">ğŸ’° Update Prices</button></div>
      </div>
    </section>
  </main>

  <div id="toast" class="alert hidden"></div>

  <script>
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker.register("/sw.js");
      });
    }
  </script>
</body>
</html>
